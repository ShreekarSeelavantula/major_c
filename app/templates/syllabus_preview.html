{% extends "layout.html" %}

{% block title %}Syllabus Preview | Prep Genie{% endblock %}

{% block content %}

<h2 class="fw-bold mb-2">Syllabus Preview</h2>
<p class="text-muted mb-3">
    Extracted from <strong>{{ syllabus.filename }}</strong>
</p>

<!-- RAW TEXT PREVIEW -->
<div class="card shadow-sm mb-4">
    <div class="card-body">

        <h5 class="fw-semibold mb-2">
            Extracted Text Preview
        </h5>

        <pre style="
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
        ">
{{ syllabus.preview_text or "No text extracted." }}
        </pre>

        {% if syllabus.error %}
            <div class="alert alert-danger mt-3">
                {{ syllabus.error }}
            </div>
        {% endif %}

        {% if not syllabus.validated %}
            <form method="post"
                  action="/syllabus/validate/{{ syllabus._id }}"
                  class="d-flex justify-content-end mt-4">
                <button type="submit" class="btn btn-success">
                    Validate syllabus â†’
                </button>
            </form>
        {% endif %}
    </div>
</div>

<!-- STRUCTURED SYLLABUS -->
{% if syllabus.validated and syllabus.structured %}

<div class="card shadow-sm mb-4">
    <div class="card-body">

        <h4 class="fw-bold mb-3">Structured Syllabus</h4>

        {% for unit in syllabus.structured %}
            <div class="mb-3">
                <h6 class="fw-semibold">
                    {{ unit.title }}
                </h6>
                <ul class="mb-2">
                    {% for topic in unit.topics %}
                        <li>{{ topic }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endfor %}

        <div class="alert alert-success mt-4">
            Syllabus validated and structured successfully.
        </div>

    </div>
</div>

{% endif %}

<a href="/upload" class="btn btn-outline-secondary">
    Re-upload
</a>

{% endblock %}
