{% extends "layout.html" %}

{% block title %}Syllabus Preview | Prep Genie{% endblock %}

{% block content %}

<h2 class="fw-bold mb-2">Syllabus Preview</h2>
<p class="text-muted mb-3">
    Extracted from <strong>{{ syllabus.filename }}</strong>
</p>

<!-- RAW TEXT PREVIEW -->
<div class="card shadow-sm mb-4">
    <div class="card-body">

        <h5 class="fw-semibold mb-2">Extracted Text Preview</h5>

        <pre style="
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
        ">
{{ syllabus.preview_text or "No text extracted." }}
        </pre>

        {% if syllabus.error %}
            <div class="alert alert-danger mt-3">
                {{ syllabus.error }}
            </div>
        {% endif %}

        {% if not syllabus.validated %}
            <form method="post"
                  action="/syllabus/validate/{{ syllabus._id }}"
                  class="d-flex justify-content-end mt-4">
                <button type="submit" class="btn btn-success">
                    Validate syllabus →
                </button>
            </form>
        {% endif %}

    </div>
</div>


<!-- VALIDATION SUCCESS -->
{% if syllabus.validated %}

<div class="alert alert-success shadow-sm">
    ✅ Syllabus validated successfully!
</div>

{% endif %}


<!-- SUBJECT SELECTION -->
{% if syllabus.validated and syllabus.subjects_detected and not syllabus.structured_syllabus %}

<div class="card shadow-sm mb-4">
    <div class="card-body">

        <h4 class="fw-bold mb-3">Select Subject to Generate Study Plan</h4>

        <div class="row">

            {% for subject in syllabus.subjects_detected %}
            <div class="col-md-6 mb-3">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">

                        <h6 class="fw-bold text-primary">
                            {{ subject.course_code }}
                        </h6>

                        <p class="mb-2">
                            {{ subject.title }}
                        </p>

                        <form method="post"
                              action="/syllabus/structure/{{ syllabus._id }}"
                              class="mt-3">

                            <input type="hidden"
                                   name="subject_text"
                                   value="{{ subject.text }}">

                            <button class="btn btn-outline-primary btn-sm w-100">
                                Generate Plan →
                            </button>

                        </form>

                    </div>
                </div>
            </div>
            {% endfor %}

        </div>

    </div>
</div>

{% endif %}


<!-- STRUCTURED SYLLABUS -->
{% if syllabus.structured_syllabus %}

<div class="card shadow-sm mb-4">
    <div class="card-body">

        <h4 class="fw-bold mb-3">Structured Syllabus</h4>

        {% for unit in syllabus.structured_syllabus %}
            <div class="mb-3">
                <h6 class="fw-semibold">
                    {{ unit.title }}
                </h6>
                <ul>
                    {% for topic in unit.topics %}
                        <li>{{ topic }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endfor %}

        <div class="alert alert-success mt-4">
            Study plan generated successfully.
        </div>

    </div>
</div>

{% endif %}

<a href="/upload" class="btn btn-outline-secondary">
    Re-upload
</a>

{% endblock %}
